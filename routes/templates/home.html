{% extends 'base.html' %}

{% block title %}
  Esafari
{% endblock %}

{% block body %}
  <div class="w-full h-screen m-0 bg-gray-50 bg-gradient-to-tr from-[#A87446] via-[#c7AB91] to-[#565A41] flex flex-col items-center content-center justify-center">
    <h1 class="text-3xl text-white">Search For Destination</h1>
    <form action="" class="w-full mx-auto flex flex-col items-center content-center justify-center" name="search">
      <input type="text" name="" class="mx-auto mt-6 h-12 w-8/12 bg-white rounded-2xl p-3 focus:outline-0 focus-ring-0 focus-border-0 focus:shadow-none" placeholder="Type a location to search" onkeyup="search_location(this.value)" />
    </form>
  </div>

  <div id="response" class="h-96 w-full"></div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {

      navigator.geolocation.getCurrentPosition((position) => {
        console.log(position.coords.latitude, position.coords.longitude)
      })
    })

    function search_location(query) {
      let xhr = new XMLHttpRequest()
      let url = `https://api.opencagedata.com/geocode/v1/json?q=${query}20%kenya&key=99944ac169fa4ecfac3c584863458c09&pretty=1`
      xhr.open('GET', url, true)
      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4) {
          if (xhr.status === 200) {
            let response = JSON.parse(xhr.responseText)
            let resultHTML = '<div class="p-4">'
            if (response.results && response.results.length > 0) {
              response.results.forEach(place => {
                resultHTML += `
                  <div class="mb-4 p-3 bg-white rounded shadow">
                    <h2 class="text-xl font-bold">${place.formatted}</h2>
                    <p>Coordinates: ${place.geometry.lat}, ${place.geometry.lng}</p>
                  </div>
                  `
              })
            } else {
              resultHTML += '<p>No results found</p>'
            }
            resultHTML += '</div>'
            document.getElementById('response').innerHTML = resultHTML
          } else {
            console.error('Error fetching data')
            document.getElementById('response').innerHTML = '<p class="p-4 text-red-500">Error fetching data</p>'
          }
        }
      }
      xhr.send()
    }
  </script>


{% endblock %}
